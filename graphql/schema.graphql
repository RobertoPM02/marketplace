"A datetime string with format `Y-m-d H:i:s`, e.g. `2018-05-23 13:43:32`."
scalar DateTime @scalar(class: "Nuwave\\Lighthouse\\Schema\\Types\\Scalars\\DateTime")

scalar Upload @scalar(class: "Nuwave\\Lighthouse\\Schema\\Types\\Scalars\\Upload")



type Query {
  user(
    id: ID @eq @rules(apply: ["prohibits:email", "required_without:email"])
    email: String @eq @rules(apply: ["prohibits:id", "required_without:id", "email"])
  ): User @find

  users(
    name: String @where(operator: "like")
  ): [User!]! @paginate(defaultCount: 10)

  viewProductsById(
    id: ID @eq @rules(apply: ["required"])
  ): Product
    @field(resolver: "App\\GraphQL\\Queries\\ViewProduct")


  product(id: ID @eq): Product @find

  products: [Product!]! @all

  allProducts: [Product!]! @paginate(defaultCount: 10)
    @guard(with: ["sanctum"])

  myProducts: [Product!]!
    @field(resolver: "App\\GraphQL\\Queries\\MyProducts")
    @guard(with: ["sanctum"])

  myCart: Cart
    @field(resolver: "App\\GraphQL\\Queries\\MyCart")
    @guard(with: ["sanctum"])

  allOrders: [Order!]! @all
   @guard(with: ["sanctum"])

  orderById(
    id: ID @eq
  ): Order
    @field(resolver: "App\\GraphQL\\Queries\\OrderQuery")
    @guard(with: ["sanctum"])

}

type Mutation {
  # REGISTRO
  createUser(
    name: String!
    email: String!
      @rules(apply: ["email", "unique:users,email"])
    number: String!
      @rename(attribute: "phone_number")
      @rules(apply: ["min:10", "max:15", "unique:users,phone_number"])
    password: String!
      @hash
      @rules(apply: ["required", "regex:/^(?=.*[A-Z])(?=.*[0-9]).{6,}$/"])
    role_id: ID!
      @rules(apply: ["exists:roles,id"])
  ): User
    @field(resolver: "App\\GraphQL\\Mutations\\CreateUser")

  # AUTH
  login(
    login: String!
      @rules(apply: ["required"])
    password: String!
      @rules(apply: ["required", "min:8"])
  ): AuthPayload
    @field(resolver: "App\\GraphQL\\Mutations\\Login")

  logout: Boolean!
    @field(resolver: "App\\GraphQL\\Mutations\\Logout")

  # PRODUCTOS
  createProduct(
    name: String! @rules(apply: ["required", "min:3"])
    price: Float! @rules(apply: ["required", "numeric", "min:0"])
    stock: Int! @rules(apply: ["required", "integer", "min:0"])
    image: Upload @rules(apply: ["image", "max:2048"])
  ): Product!
    @field(resolver: "App\\GraphQL\\Mutations\\CreateProduct")
    @guard(with: ["sanctum"])
    
  deleteProduct(
    id: ID!
  ): Product
    @field(resolver: "App\\GraphQL\\Mutations\\DeleteProduct")
    @guard(with: ["sanctum"])


  # CARRITO
  addToCart(
    product_id: ID!
    quantity: Int = 1
  ): Cart
    @field(resolver: "App\\GraphQL\\Mutations\\AddToCart")
    @guard(with: ["sanctum"])

  updateCartItem(
    cart_item_id: ID!
    quantity: Int!
  ): Cart
    @field(resolver: "App\\GraphQL\\Mutations\\UpdateCartItem")
    @guard(with: ["sanctum"])

  removeFromCart(
    cart_item_id: ID!
  ): Cart
    @field(resolver: "App\\GraphQL\\Mutations\\RemoveFromCart")
    @guard(with: ["sanctum"])

  newOrder(
    address: String! @rules(apply: ["required", "min:5"])
    payment_method: PaymentMethod! @rules(apply: ["required"])
    items: [OrderItemInput!]! @rules(apply: ["required", "min:1"])
  ): Order
    @field(resolver: "App\\GraphQL\\Mutations\\NewOrder")
    @guard(with: ["sanctum"])
}

type User {
  id: ID!
  name: String!
  email: String!
  number: String! @rename(attribute: "phone_number")
  email_verified_at: DateTime
  created_at: DateTime!
  updated_at: DateTime!
  role: Role @belongsTo
}

type Role {
  id: ID!
  name: String!
}

type AuthPayload {
  access_token: String!
  token_type: String!
  user: User!
}

type Product {
  id: ID!
  name: String!
  price: Float!
  stock: Int!
  image: String @rename(attribute: "image_url")
  created_at: DateTime!
  updated_at: DateTime!
  user_id: ID
  user: User @belongsTo
}

type Cart {
  id: ID!
  items: [CartItem!]! @hasMany
  subtotal: Float!
  shipping: Float!
  taxes: Float!
  total: Float!
}

type CartItem {
  id: ID!
  product: Product!
  quantity: Int!
}


type Order {
  id: ID!
  user: User! @belongsTo
  address: String!
  status: String!
  payment_method: String!
  sub_total: Float!
  tax: Float!
  shipping: Float!
  total: Float!
  created_at: DateTime!
  items: [OrderItem!]! @hasMany
}

type OrderItem {
  id: ID!
  order: Order! @belongsTo
  product: Product! @belongsTo
  quantity: Int!
  price: Float!
}

input OrderItemInput {
  product_id: ID!
  quantity: Int!
}

enum PaymentMethod {
  EFECTIVO
  MASTERCARD
  VISA
  PAYPAL
}
